import{a as R}from"./chunk-YPIEIWXV.js";import{a as D}from"./chunk-2OTDXTYC.js";import{e as z}from"./chunk-TJS7GMF3.js";import{$ as m,$a as N,Ab as $,Da as M,E as C,Ea as V,G as o,H as c,K as b,L as F,O as g,Q as s,Qa as k,S as T,U as a,Ua as O,V as l,Va as A,W as v,Z as y,_ as p,a as x,b as S,eb as P,ia as d,ja as j,ka as w,nb as U,pa as E,pb as W,r as I,w as f,x as _}from"./chunk-76546ULM.js";var J=()=>["Author","Average","Round"];function L(n,h){if(n&1){let t=y();a(0,"wselect",1),p("modelChange",function(e){f(t);let r=m();return r.gameplay.world=e,r.mfs.load(r.gameplay),_(r.config())}),l()}if(n&2){let t=m();s("select",t.gameplay.world)("items",t.mfs.worlds)}}function Y(n,h){if(n&1){let t=y();a(0,"wselect",1),p("modelChange",function(e){f(t);let r=m();return r.gameplay.story=e,_(r.config())}),l()}if(n&2){let t=m();s("select",t.gameplay.story)("items",t.mfs.rootStories)}}function q(n,h){if(n&1&&(a(0,"div"),v(1,"img",6),a(2,"span"),d(3),l()()),n&2){let t,i=h.$implicit,e=m();T("joined",e.player(i)),o(),s("src",(t=e.mfs.hero[e.player(i).hero])!=null&&t.thumb?e.url+((t=e.mfs.hero[e.player(i).hero])==null?null:t.thumb):"/assets/default.png",C)("alt",e.player(i).name||e.us.doc(i).name||e.us.doc(i).email),o(2),w("",e.player(i).name||e.us.doc(i).name||e.us.doc(i).email," ")}}function G(n,h){if(n&1){let t=y();a(0,"div",5),p("click",function(){let e=f(t).$implicit,r=m();return r.hero=e._id,_(r.config())}),v(1,"img",6),a(2,"span"),d(3),l()()}if(n&2){let t=h.$implicit,i=m();o(),s("src",t.thumb?i.url+t.thumb:"/assets/default.png",C)("alt",t.name),o(2),j(t.name)}}var B=(()=>{class n{player(t){return this.players[t]||{}}constructor(t,i,e,r,u){this.mfs=t,this._http=i,this._core=e,this._router=r,this.us=u,this.url=A.url,this.gameplay=this.mfs.doc(this._router.url.replace("/create/","")),this.hero="",this.name="",this.players={},this._core.onComplete("manaforgeLoaded").then(this._load.bind(this))}config(){this.players[this.us.user._id]&&(this.players[this.us.user._id].name=this.name,this.players[this.us.user._id].hero=this.hero);let t={_id:this.gameplay._id,hero:this.hero,name:this.name};this._http.post("/api/manaforge/config",this.gameplay.author===this.us.user._id?S(x({},t),{world:this.gameplay.world,mana:this.gameplay.mana,story:this.gameplay.story}):t).subscribe(i=>{i&&(this.gameplay=i)})}configAfterWhile(){this._core.afterWhile(this,this.config.bind(this))}start(){}_load(){this.gameplay=this.mfs.doc(this._router.url.replace("/create/",""));let t=this.gameplay.players.find(i=>i.user===this.us.user._id);this.name=t?.name||"",this.hero=t?.hero||"",this.mfs.load(this.gameplay);for(let i of this.gameplay.players)this.players[i.user]=i}static{this.\u0275fac=function(i){return new(i||n)(c(D),c(P),c(N),c(k),c(R))}}static{this.\u0275cmp=b({type:n,selectors:[["ng-component"]],standalone:!1,decls:14,vars:9,consts:[[3,"select","items","modelChange",4,"ngIf"],[3,"modelChange","select","items"],[3,"joined",4,"ngFor","ngForOf"],["label","Your name","placeholder","Fill your name",3,"wChange","value"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[2,"height","50px",3,"src","alt"]],template:function(i,e){i&1&&(a(0,"div")(1,"div"),d(2),l(),g(3,L,1,2,"wselect",0)(4,Y,1,2,"wselect",0),a(5,"wselect",1),p("modelChange",function(u){return e.gameplay.mana=u,e.config()}),l(),a(6,"div")(7,"h2"),d(8,"Players"),l(),g(9,q,4,5,"div",2),l(),a(10,"winput",3),p("wChange",function(u){return e.name=u.toString(),e.configAfterWhile()}),l(),g(11,G,4,3,"div",4),a(12,"wbutton",5),p("click",function(){return e.start()}),d(13,"Start"),l()()),i&2&&(o(2),w("Join code: ",e.gameplay.code,""),o(),s("ngIf",e.mfs.worlds==null?null:e.mfs.worlds.length),o(),s("ngIf",e.mfs.rootStories==null?null:e.mfs.rootStories.length),o(),s("select",e.gameplay.mana)("items",E(8,J)),o(4),s("ngForOf",e.gameplay.moderators),o(),s("value",e.name),o(),s("ngForOf",e.mfs.heroes))},dependencies:[$,M,V,U,W],styles:[".joined[_ngcontent-%COMP%]{background-color:#ff0}"]})}}return n})();var K=[{path:":manaforge",component:B}],ce=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=F({type:n})}static{this.\u0275inj=I({imports:[O.forChild(K),z]})}}return n})();export{ce as CreateModule};
