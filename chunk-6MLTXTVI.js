import{e as I}from"./chunk-TJS7GMF3.js";import{$a as c,H as n,K as p,L as y,Q as g,Qa as v,Ua as S,W as _,cb as w,db as C,eb as j,gb as m,lb as b,q as d,r as u,sb as M,t as a,ub as k}from"./chunk-76546ULM.js";var x={formId:"manaforgestory",title:"Manaforgestory",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill manaforgestory title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill manaforgestory description"},{name:"Label",value:"Description"}]}]};var B=(()=>{class o extends w{constructor(r,e,t,s){super({name:"manaforgestory"},r,e,t,s),this.manaforgestorys=this.getDocs(),this.manaforgestorysByStory={},this.manaforgestorysByWorld={},this.get(),this.filteredDocuments(this.manaforgestorysByStory,"story"),this.filteredDocuments(this.manaforgestorysByWorld,"world")}static{this.\u0275fac=function(e){return new(e||o)(a(j),a(C),a(m),a(c))}}static{this.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var l=(()=>{class o{get rows(){return this.story?this._manaforgestoryService.manaforgestorysByStory[this.story]:this.world?this._manaforgestoryService.manaforgestorysByWorld[this.world]:this._manaforgestoryService.manaforgestorys}constructor(r,e,t,s,f,D){this._translate=r,this._manaforgestoryService=e,this._alert=t,this._form=s,this._core=f,this._router=D,this.world=this._router.url.includes("/stories/")?this._router.url.split("/")[2]:"",this.story=this._router.url.includes("/stories/")&&this._router.url.split("/").length>3?this._router.url.split("/")[3]:"",this.columns=["name","description"],this.form=this._form.getForm("manaforgestory",x),this.config={create:()=>{this._form.modal(this.form,{label:"Create",click:(i,h)=>{this._preCreate(i),this._manaforgestoryService.create(i),h()}})},update:i=>{this._form.modal(this.form,[],i).then(h=>{this._core.copy(h,i),this._manaforgestoryService.update(i)})},delete:i=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this manaforgestory?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._manaforgestoryService.delete(i)}}]})},buttons:[{icon:"cloud_download",click:i=>{this._form.modalUnique("manaforgestory","url",i)}},this.world?{icon:"auto_stories",hrefFunc:i=>`/stories/${this.world}/${i._id}`}:null],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]}}_bulkManagement(r=!0){return()=>{this._form.modalDocs(r?[]:this.rows).then(e=>{if(r)for(let t of e)this._preCreate(t),this._manaforgestoryService.create(t);else{for(let t of this.rows)e.find(s=>s._id===t._id)||this._manaforgestoryService.delete(t);for(let t of e){let s=this.rows.find(f=>f._id===t._id);s?(this._core.copy(t,s),this._manaforgestoryService.update(s)):(this._preCreate(t),this._manaforgestoryService.create(t))}}})}}_preCreate(r){r.__created,this.world&&(r.world=this.world),this.story&&(r.story=this.story)}static{this.\u0275fac=function(e){return new(e||o)(n(b),n(B),n(m),n(k),n(c),n(v))}}static{this.\u0275cmp=p({type:o,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Stories",3,"columns","config","rows"]],template:function(e,t){e&1&&_(0,"wtable",0),e&2&&g("columns",t.columns)("config",t.config)("rows",t.rows)},dependencies:[M],encapsulation:2})}}return o})();var N=[{path:"",component:l},{path:":world",component:l},{path:":world/:story",component:l}],G=(()=>{class o{static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275mod=y({type:o})}static{this.\u0275inj=u({imports:[S.forChild(N),I]})}}return o})();export{G as StoriesModule};
